<!DOCTYPE html>
<html lang="en">
<head>

    
        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-08VXMP329W"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-08VXMP329W');
</script>

    

    <meta charset="utf-8">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <meta name=author content="Nicola Di Santo">

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Fast Document Similarity In Python with Minhash Locality Sensitive Hashing (MinHashLSH) | Nicola Di Santo</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Fast Document Similarity In Python with Minhash Locality Sensitive Hashing (MinHashLSH)" />
<meta name="author" content="nicods" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="How to implement fast document duplicate detection in python using locality sensitive hashing." />
<meta property="og:description" content="How to implement fast document duplicate detection in python using locality sensitive hashing." />
<link rel="canonical" href="https://nicods96.github.io/hi/fast-document-similarity-in-python/" />
<meta property="og:url" content="https://nicods96.github.io/hi/fast-document-similarity-in-python/" />
<meta property="og:site_name" content="Nicola Di Santo" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-09-08T18:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Fast Document Similarity In Python with Minhash Locality Sensitive Hashing (MinHashLSH)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"nicods"},"dateModified":"2022-09-08T18:00:00+00:00","datePublished":"2022-09-08T18:00:00+00:00","description":"How to implement fast document duplicate detection in python using locality sensitive hashing.","headline":"Fast Document Similarity In Python with Minhash Locality Sensitive Hashing (MinHashLSH)","mainEntityOfPage":{"@type":"WebPage","@id":"https://nicods96.github.io/hi/fast-document-similarity-in-python/"},"url":"https://nicods96.github.io/hi/fast-document-similarity-in-python/"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://nicods96.github.io/hi/assets/images/favicon/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://nicods96.github.io/hi/assets/images/favicon/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://nicods96.github.io/hi/assets/images/favicon/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://nicods96.github.io/hi/assets/images/favicon/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://nicods96.github.io/hi/assets/images/favicon/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://nicods96.github.io/hi/assets/images/favicon/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://nicods96.github.io/hi/assets/images/favicon/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://nicods96.github.io/hi/assets/images/favicon/apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="https://nicods96.github.io/hi/assets/images/favicon/favicon-196x196.png" sizes="196x196" />
<link rel="icon" type="image/png" href="https://nicods96.github.io/hi/assets/images/favicon/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="https://nicods96.github.io/hi/assets/images/favicon/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="https://nicods96.github.io/hi/assets/images/favicon/favicon-16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="https://nicods96.github.io/hi/assets/images/favicon/favicon-128.png" sizes="128x128" />
<meta name="application-name" content="&nbsp;"/>
<meta name="msapplication-TileColor" content="#FFFFFF" />
<meta name="msapplication-TileImage" content="mstile-144x144.png" />
<meta name="msapplication-square70x70logo" content="mstile-70x70.png" />
<meta name="msapplication-square150x150logo" content="mstile-150x150.png" />
<meta name="msapplication-wide310x150logo" content="mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="mstile-310x310.png" />


    <link rel="canonical" href="https://nicods96.github.io/hi/fast-document-similarity-in-python/">
    <link rel="alternate" type="application/rss+xml" title="" href="https://nicods96.github.io/hi/feed.xml" />

    <style>
    

    @charset "UTF-8";
/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */
/* Document
   ========================================================================== */
/**
 * 1. Correct the line height in all browsers.
 * 2. Prevent adjustments of font size after orientation changes in iOS.
 */
html {
  line-height: 1.15;
  /* 1 */
  -webkit-text-size-adjust: 100%;
  /* 2 */ }

/* Sections
   ========================================================================== */
/**
 * Remove the margin in all browsers.
 */
body {
  margin: 0; }

/**
 * Render the `main` element consistently in IE.
 */
main {
  display: block; }

/**
 * Correct the font size and margin on `h1` elements within `section` and
 * `article` contexts in Chrome, Firefox, and Safari.
 */
h1 {
  font-size: 2em;
  margin: 0.67em 0; }

/* Grouping content
   ========================================================================== */
/**
 * 1. Add the correct box sizing in Firefox.
 * 2. Show the overflow in Edge and IE.
 */
hr {
  box-sizing: content-box;
  /* 1 */
  height: 0;
  /* 1 */
  overflow: visible;
  /* 2 */ }

/**
 * 1. Correct the inheritance and scaling of font size in all browsers.
 * 2. Correct the odd `em` font sizing in all browsers.
 */
pre {
  font-family: monospace, monospace;
  /* 1 */
  font-size: 1em;
  /* 2 */ }

/* Text-level semantics
   ========================================================================== */
/**
 * Remove the gray background on active links in IE 10.
 */
a {
  background-color: transparent; }

/**
 * 1. Remove the bottom border in Chrome 57-
 * 2. Add the correct text decoration in Chrome, Edge, IE, Opera, and Safari.
 */
abbr[title] {
  border-bottom: none;
  /* 1 */
  text-decoration: underline;
  /* 2 */
  text-decoration: underline dotted;
  /* 2 */ }

/**
 * Add the correct font weight in Chrome, Edge, and Safari.
 */
b,
strong {
  font-weight: bolder; }

/**
 * 1. Correct the inheritance and scaling of font size in all browsers.
 * 2. Correct the odd `em` font sizing in all browsers.
 */
code,
kbd,
samp {
  font-family: monospace, monospace;
  /* 1 */
  font-size: 1em;
  /* 2 */ }

/**
 * Add the correct font size in all browsers.
 */
small {
  font-size: 80%; }

/**
 * Prevent `sub` and `sup` elements from affecting the line height in
 * all browsers.
 */
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline; }

sub {
  bottom: -0.25em; }

sup {
  top: -0.5em; }

/* Embedded content
   ========================================================================== */
/**
 * Remove the border on images inside links in IE 10.
 */
img {
  border-style: none; }

/* Forms
   ========================================================================== */
/**
 * 1. Change the font styles in all browsers.
 * 2. Remove the margin in Firefox and Safari.
 */
button,
input,
optgroup,
select,
textarea {
  font-family: inherit;
  /* 1 */
  font-size: 100%;
  /* 1 */
  line-height: 1.15;
  /* 1 */
  margin: 0;
  /* 2 */ }

/**
 * Show the overflow in IE.
 * 1. Show the overflow in Edge.
 */
button,
input {
  /* 1 */
  overflow: visible; }

/**
 * Remove the inheritance of text transform in Edge, Firefox, and IE.
 * 1. Remove the inheritance of text transform in Firefox.
 */
button,
select {
  /* 1 */
  text-transform: none; }

/**
 * Correct the inability to style clickable types in iOS and Safari.
 */
button,
[type="button"],
[type="reset"],
[type="submit"] {
  -webkit-appearance: button; }

/**
 * Remove the inner border and padding in Firefox.
 */
button::-moz-focus-inner,
[type="button"]::-moz-focus-inner,
[type="reset"]::-moz-focus-inner,
[type="submit"]::-moz-focus-inner {
  border-style: none;
  padding: 0; }

/**
 * Restore the focus styles unset by the previous rule.
 */
button:-moz-focusring,
[type="button"]:-moz-focusring,
[type="reset"]:-moz-focusring,
[type="submit"]:-moz-focusring {
  outline: 1px dotted ButtonText; }

/**
 * Correct the padding in Firefox.
 */
fieldset {
  padding: 0.35em 0.75em 0.625em; }

/**
 * 1. Correct the text wrapping in Edge and IE.
 * 2. Correct the color inheritance from `fieldset` elements in IE.
 * 3. Remove the padding so developers are not caught out when they zero out
 *    `fieldset` elements in all browsers.
 */
legend {
  box-sizing: border-box;
  /* 1 */
  color: inherit;
  /* 2 */
  display: table;
  /* 1 */
  max-width: 100%;
  /* 1 */
  padding: 0;
  /* 3 */
  white-space: normal;
  /* 1 */ }

/**
 * Add the correct vertical alignment in Chrome, Firefox, and Opera.
 */
progress {
  vertical-align: baseline; }

/**
 * Remove the default vertical scrollbar in IE 10+.
 */
textarea {
  overflow: auto; }

/**
 * 1. Add the correct box sizing in IE 10.
 * 2. Remove the padding in IE 10.
 */
[type="checkbox"],
[type="radio"] {
  box-sizing: border-box;
  /* 1 */
  padding: 0;
  /* 2 */ }

/**
 * Correct the cursor style of increment and decrement buttons in Chrome.
 */
[type="number"]::-webkit-inner-spin-button,
[type="number"]::-webkit-outer-spin-button {
  height: auto; }

/**
 * 1. Correct the odd appearance in Chrome and Safari.
 * 2. Correct the outline style in Safari.
 */
[type="search"] {
  -webkit-appearance: textfield;
  /* 1 */
  outline-offset: -2px;
  /* 2 */ }

/**
 * Remove the inner padding in Chrome and Safari on macOS.
 */
[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none; }

/**
 * 1. Correct the inability to style clickable types in iOS and Safari.
 * 2. Change font properties to `inherit` in Safari.
 */
::-webkit-file-upload-button {
  -webkit-appearance: button;
  /* 1 */
  font: inherit;
  /* 2 */ }

/* Interactive
   ========================================================================== */
/*
 * Add the correct display in Edge, IE 10+, and Firefox.
 */
details {
  display: block; }

/*
 * Add the correct display in all browsers.
 */
summary {
  display: list-item; }

/* Misc
   ========================================================================== */
/**
 * Add the correct display in IE 10+.
 */
template {
  display: none; }

/**
 * Add the correct display in IE 10.
 */
[hidden] {
  display: none; }

.highlight .c {
  color: #999988;
  font-style: italic; }
.highlight .err {
  color: #a61717;
  background-color: #e3d2d2; }
.highlight .k {
  font-weight: bold; }
.highlight .o {
  font-weight: bold; }
.highlight .cm {
  color: #999988;
  font-style: italic; }
.highlight .cp {
  color: #999999;
  font-weight: bold; }
.highlight .c1 {
  color: #999988;
  font-style: italic; }
.highlight .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic; }
.highlight .gd {
  color: #000000;
  background-color: #ffdddd; }
.highlight .gd .x {
  color: #000000;
  background-color: #ffaaaa; }
.highlight .ge {
  font-style: italic; }
.highlight .gr {
  color: #aa0000; }
.highlight .gh {
  color: #999999; }
.highlight .gi {
  color: #000000;
  background-color: #ddffdd; }
.highlight .gi .x {
  color: #000000;
  background-color: #aaffaa; }
.highlight .go {
  color: #888888; }
.highlight .gp {
  color: #555555; }
.highlight .gs {
  font-weight: bold; }
.highlight .gu {
  color: #800080;
  font-weight: bold; }
.highlight .gt {
  color: #aa0000; }
.highlight .kc {
  font-weight: bold; }
.highlight .kd {
  font-weight: bold; }
.highlight .kn {
  font-weight: bold; }
.highlight .kp {
  font-weight: bold; }
.highlight .kr {
  font-weight: bold; }
.highlight .kt {
  color: #445588;
  font-weight: bold; }
.highlight .m {
  color: #009999; }
.highlight .s {
  color: #dd1144; }
.highlight .n {
  color: #333333; }
.highlight .na {
  color: teal; }
.highlight .nb {
  color: #0086b3; }
.highlight .nc {
  color: #445588;
  font-weight: bold; }
.highlight .no {
  color: teal; }
.highlight .ni {
  color: purple; }
.highlight .ne {
  color: #990000;
  font-weight: bold; }
.highlight .nf {
  color: #990000;
  font-weight: bold; }
.highlight .nn {
  color: #555555; }
.highlight .nt {
  color: navy; }
.highlight .nv {
  color: teal; }
.highlight .ow {
  font-weight: bold; }
.highlight .w {
  color: #bbbbbb; }
.highlight .mf {
  color: #009999; }
.highlight .mh {
  color: #009999; }
.highlight .mi {
  color: #009999; }
.highlight .mo {
  color: #009999; }
.highlight .sb {
  color: #dd1144; }
.highlight .sc {
  color: #dd1144; }
.highlight .sd {
  color: #dd1144; }
.highlight .s2 {
  color: #dd1144; }
.highlight .se {
  color: #dd1144; }
.highlight .sh {
  color: #dd1144; }
.highlight .si {
  color: #dd1144; }
.highlight .sx {
  color: #dd1144; }
.highlight .sr {
  color: #009926; }
.highlight .s1 {
  color: #dd1144; }
.highlight .ss {
  color: #990073; }
.highlight .bp {
  color: #999999; }
.highlight .vc {
  color: teal; }
.highlight .vg {
  color: teal; }
.highlight .vi {
  color: teal; }
.highlight .il {
  color: #009999; }
.highlight .gc {
  color: #999;
  background-color: #EAF2F5; }

body, html {
  font-size: 62.5%; }

body {
  font: 16px "Helvetica Neue", Helvetica, Arial, sans-serif;
  color: #666;
  background: #fff; }

h1, h2, h3, h4 {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  color: #222;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility; }

h1 {
  font-size: 3rem;
  letter-spacing: -1px;
  color: #222;
  font-weight: 700; }

h2 {
  font-size: 2.2rem; }

h3 {
  font-size: 2rem; }

h4 {
  font-size: 1.6rem; }

a {
  color: #4b0082;
  text-decoration: underline;
  font-weight: 300; }

p {
  line-height: 1.7;
  color: #666;
  font-weight: 300;
  margin-bottom: 20px;
  letter-spacing: 0.4px; }
  @media only screen and (max-width: 400px) {
    p {
      letter-spacing: 0.2px; } }

strong {
  font-weight: 400;
  color: #000; }

ul li,
ol li {
  line-height: 2.4rem;
  font-weight: 300;
  color: #666; }

img,
pre,
iframe {
  max-width: 100%; }

img,
pre {
  border-radius: 4px; }

figcaption {
  position: relative;
  top: -20px;
  left: 0;
  right: 0;
  margin: 0 auto;
  width: 100%;
  text-align: center;
  font-size: 1.3rem;
  color: #aaa;
  font-weight: 300; }
  @media only screen and (max-width: 400px) {
    figcaption {
      font-size: 1.2rem; } }

blockquote {
  padding-left: 15px;
  border-left: 3px solid #eee; }

hr {
  border: none;
  height: 1px;
  margin: 40px auto;
  background: #eee;
  width: 100%; }

figure.highlight {
  width: 100%;
  margin: 0; }

code {
  padding: 2px 3px;
  font-family: "Consolas", Liberation Mono, Menlo, Courier, monospace;
  font-size: 12px;
  vertical-align: middle;
  background: #eee;
  border-radius: 2px; }

pre > code,
tt {
  padding: 1px 0;
  font-family: "Consolas", Liberation Mono, Menlo, Courier, monospace;
  font-size: 12px;
  line-height: 20px;
  background: #fff;
  border-radius: 2px; }

pre {
  box-sizing: border-box;
  margin: 0 0 1.75em 0;
  width: 100%;
  padding: 5px 10px;
  font-family: "Consolas", Liberation Mono, Menlo, Courier, monospace;
  font-size: 1.2rem;
  line-height: 2rem;
  overflow: auto;
  background: #fff;
  border: 1px solid #ededed;
  border-radius: 2px; }

.wrapper-normal,
.wrapper-large {
  height: 100%;
  width: 96%;
  margin: 0 auto; }
  @media only screen and (max-width: 400px) {
    .wrapper-normal,
    .wrapper-large {
      width: 88%; } }
  @media only screen and (min-width: 400px) and (max-width: 1050px) {
    .wrapper-normal,
    .wrapper-large {
      width: 88%; } }

.wrapper-normal {
  max-width: 560px; }

.wrapper-large {
  max-width: 810px; }

/* general helpers
 */
.text-center {
  text-align: center; }

.clearfix:before,
.clearfix:after {
  content: "";
  display: table; }

.clearfix:after {
  clear: both; }

/* animations
 */
.animated {
  animation: fade-in-down 0.6s;
  animation-delay: 0.3s;
  animation-fill-mode: both; }

@keyframes fade-in-down {
  0% {
    opacity: 0;
    transform: translateY(-10px); }
  100% {
    opacity: 1;
    transform: translateY(0); } }
.home,
.blog,
.projects {
  margin-top: 125px; }
  .home > .list,
  .blog > .list,
  .projects > .list {
    border-top: 1px solid #ededed;
    margin-top: 30px;
    padding-top: 40px;
    position: relative; }
    .home > .list:before,
    .blog > .list:before,
    .projects > .list:before {
      display: block;
      content: " ";
      width: 7px;
      height: 7px;
      border: #ededed 1px solid;
      position: absolute;
      top: -5px;
      left: 50%;
      margin-left: -5px;
      background: #fff;
      box-shadow: #fff 0 0 0 5px;
      border-radius: 3px; }

.home > .list > .item,
.blog > .list > .item,
.projects > .list > .item {
  display: block;
  width: 95%;
  margin: 0 auto; }
.home > .list > .item > .url,
.blog > .list > .item > .url,
.projects > .list > .item > .url {
  width: 100%;
  display: block;
  padding: 20px 0;
  text-decoration: none; }
.home > .list > .item > .url > .title,
.blog > .list > .item > .url > .title,
.projects > .list > .item > .url > .title {
  margin: 0;
  width: 75%;
  font-weight: 500;
  transition: all ease-in-out 0.2s; }
.home > .list > .item:hover > .url > .title,
.blog > .list > .item:hover > .url > .title,
.projects > .list > .item:hover > .url > .title {
  color: #4b0082; }
.home > .list aside,
.blog > .list aside,
.projects > .list aside {
  position: relative;
  top: 2px;
  margin: 0;
  width: 25%;
  float: right;
  font-weight: 300;
  color: #aaa;
  text-align: right;
  transition: all ease-in-out 0.2s; }
.home > .list .item:hover .url aside,
.blog > .list .item:hover .url aside,
.projects > .list .item:hover .url aside {
  color: #666; }

.blog > .list > .item > .url > .title,
.projects > .list > .item > .url > .title {
  display: inline; }
.blog > .list > .item > .url > .emoji,
.projects > .list > .item > .url > .emoji {
  display: inline;
  position: relative;
  top: -4px;
  margin-right: 10px; }

.page {
  margin-top: 125px; }
  .page > h1 {
    text-align: center;
    margin-bottom: 6rem; }

.about img {
  width: 50%;
  margin: 0 auto;
  display: block; }

.post {
  margin-top: 125px; }
  .post > .title {
    text-align: center;
    margin-bottom: 3rem; }
  .post > .date,
  .post > .post-tags {
    color: #aaa;
    font-weight: 300;
    font-size: 1.4rem;
    text-transform: uppercase;
    text-align: center;
    display: block;
    margin-bottom: 6rem;
    letter-spacing: 1px;
    -webkit-font-smoothing: antialiased;
    text-rendering: optimizeLegibility; }
  .post > .date {
    margin-bottom: 2rem; }
  .post > .post-tags > .item {
    padding: 2px 8px;
    border-radius: 3px;
    font-size: 1.1rem;
    background: #ededed;
    color: #666;
    letter-spacing: 1px;
    margin: 3px 1px;
    text-decoration: none;
    display: inline-block; }
  .post > h2,
  .post > h3,
  .post > h4 {
    margin-top: 40px; }
    .post > h2 a,
    .post > h3 a,
    .post > h4 a {
      text-decoration: none; }
  .post > .title-image {
    max-height: 120px;
    display: block;
    margin: 0 auto; }
  .post > .blog-navigation {
    font-size: 1.4rem;
    display: block;
    width: auto;
    overflow: hidden; }
    .post > .blog-navigation a {
      display: block;
      width: 50%;
      float: left;
      margin: 1em 0; }
    .post > .blog-navigation .next {
      text-align: right; }

.tags {
  margin-top: 125px; }
  .tags > .list {
    border-top: 1px solid #ededed;
    margin-top: 30px;
    padding-top: 40px;
    position: relative; }
    .tags > .list:before {
      display: block;
      content: " ";
      width: 7px;
      height: 7px;
      border: #ededed 1px solid;
      position: absolute;
      top: -5px;
      left: 50%;
      margin-left: -5px;
      background: #fff;
      box-shadow: #fff 0 0 0 5px;
      border-radius: 3px; }

.tags > .list > .item {
  font-weight: 300;
  text-transform: uppercase;
  text-align: center;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
  padding: 3px 9px;
  border-radius: 3px;
  font-size: 1.3rem;
  background: #ededed;
  color: #666;
  letter-spacing: 1px;
  margin: 0 0.5rem 1rem;
  text-decoration: none;
  display: inline-block; }

.tag-list > .list {
  padding: 0; }
  .tag-list > .list > .item {
    display: block;
    width: 80%;
    margin: 0 10%; }
  .tag-list > .list > .item > .url {
    width: 100%;
    height: 100%;
    display: block;
    padding: 20px 0;
    text-decoration: none; }
  .tag-list > .list > .item > .url > .title {
    margin: 0;
    width: 75%;
    font-weight: 400;
    transition: all ease-in-out 0.2s;
    font-size: 1.6rem; }
  .tag-list > .list > .item:hover > .url > .title {
    color: #4b0082; }
  .tag-list > .list aside {
    position: relative;
    top: 2px;
    margin: 0;
    width: 25%;
    float: right;
    font-weight: 300;
    color: #aaa;
    text-align: right;
    transition: all ease-in-out 0.2s;
    font-size: 1.6rem; }
  .tag-list > .list .item:hover .url aside {
    color: #666; }

.author {
  padding: 3rem 0;
  border-bottom: 1px solid #ededed;
  border-top: 1px solid #ededed;
  max-width: 100%;
  margin: 4rem auto 0; }
  .author > .toleft > .selfie {
    width: 90%;
    border-radius: 100%; }
  .author > .toright > .name,
  .author > .toright > .bio {
    width: 60%;
    display: inline-block; }
  .author > .toright > .name {
    font-size: 1.5rem;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    font-weight: 500;
    margin: 6px 0 0; }
    @media only screen and (max-width: 400px) {
      .author > .toright > .name {
        width: 100%;
        display: block; } }
    @media only screen and (min-width: 400px) and (max-width: 1050px) {
      .author > .toright > .name {
        width: 100%;
        display: block; } }
  .author > .toright > .bio {
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    font-weight: 300;
    color: #aaa;
    font-size: 1.3rem;
    text-align: justify;
    line-height: 1.5;
    margin: 0; }
    @media only screen and (max-width: 400px) {
      .author > .toright > .bio {
        width: 100%;
        display: block; } }
    @media only screen and (min-width: 400px) and (max-width: 1050px) {
      .author > .toright > .bio {
        width: 100%;
        display: block; } }
  .author > .toleft {
    width: 10%;
    display: inline-block; }
    @media only screen and (max-width: 400px) {
      .author > .toleft {
        width: 20%; } }
    @media only screen and (min-width: 400px) and (max-width: 1050px) {
      .author > .toleft {
        width: 20%; } }
  .author > .toright {
    width: 89%;
    display: inline-block;
    vertical-align: top; }
    @media only screen and (max-width: 400px) {
      .author > .toright {
        width: 78%; } }
    @media only screen and (min-width: 400px) and (max-width: 1050px) {
      .author > .toright {
        width: 78%; } }

.no-disqus {
  border-bottom: none;
  padding-bottom: 0; }

.disqus {
  margin: 0 auto;
  max-width: 100%;
  padding: 40px 0; }

.footer-main {
  border-top: 1px solid #ededed;
  padding: 40px 0;
  margin: 40px 0 0;
  font-size: 1.3rem;
  color: #aaa;
  font-weight: 300;
  text-align: center;
  position: relative; }
  .footer-main:before {
    display: block;
    content: " ";
    width: 7px;
    height: 7px;
    border: #ededed 1px solid;
    position: absolute;
    top: -5px;
    left: 50%;
    margin-left: -5px;
    background: #fff;
    box-shadow: #fff 0 0 0 5px;
    border-radius: 3px; }
  .footer-main > .copyright {
    padding-left: 10px; }
  .footer-main > .link {
    display: inline;
    vertical-align: middle; }
    .footer-main > .link > .icon {
      width: 15px !important;
      fill: #aaa !important;
      transition: ease-in-out all 0.3s;
      position: relative;
      display: inherit;
      top: -2px;
      margin: 0;
      left: 2px; }
      .footer-main > .link > .icon:hover {
        fill: #4b0082 !important; }
  .footer-main > .extra {
    color: #aaa;
    margin-top: 0;
    font-weight: 300; }
    .footer-main > .extra > .link {
      color: #222;
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: ease-in-out all 0.3s;
      padding-bottom: 1px;
      font-weight: 300; }
      .footer-main > .extra > .link:hover {
        border-color: #aaa; }

.header-home {
  display: block;
  margin: 0 auto;
  text-align: center;
  position: relative;
  z-index: 99; }
  .header-home > .link > .selfie {
    width: 125px;
    height: 125px;
    margin-bottom: 25px;
    border-radius: 100%;
    transition: all 0.2s;
    opacity: 1; }
    .header-home > .link > .selfie:hover {
      box-shadow: 0 0px 4px 0 rgba(0, 0, 0, 0.18), 0 0px 12px 0 rgba(0, 0, 0, 0.15);
      opacity: 0.8; }
  .header-home > .title {
    font-size: 4rem;
    margin: 0 0 13px; }
  .header-home > .description {
    font-size: 1.85rem;
    font-weight: 300;
    font-style: normal;
    color: #aaa;
    width: 70%;
    margin: 0 auto 30px; }
    .header-home > .description a {
      font-weight: 200; }

.nav > .list,
.nav-home > .list {
  list-style: none;
  margin: 0;
  padding: 0 13px 0; }
  .nav > .list > .item,
  .nav-home > .list > .item {
    display: inline-block; }
  .nav > .list > .item > .link,
  .nav-home > .list > .item > .link {
    display: inline-block;
    font-weight: 300;
    font-size: 1.4rem;
    padding: 20px 10px;
    text-decoration: none; }

.nav {
  position: absolute;
  right: 0;
  top: 0; }
  .nav > .list {
    padding: 0 13px 0; }
    .nav > .list > .item > .link {
      font-size: 1.4rem;
      padding: 20px 10px; }

.nav-home {
  margin-top: 40px;
  text-align: center; }
  .nav-home > .list {
    padding: 0; }
    .nav-home > .list > .item > .link {
      font-size: 2rem;
      padding: 7px 15px;
      margin: 0;
      border-radius: 4%;
      transition: all 0.4s ease-in-out;
      width: 70px; }
      .nav-home > .list > .item > .link:hover {
        color: #666; }

.evidence {
  background-image: linear-gradient(to bottom, #27f36a26, #27f36a26);
  color: #222; }

.star > .url > .title {
  width: auto !important;
  display: inline;
  background-image: linear-gradient(#27f36a26, #27f36a26); }

.twitter-tweet {
  margin: 10px auto; }

.icon {
  display: inline-block;
  width: 17px;
  height: 17px;
  fill: #000;
  text-align: center;
  color: #aaa;
  margin: 7px auto; }

.caption {
  position: relative;
  top: 1rem;
  left: 0;
  right: 0;
  margin: 0 auto;
  width: 100%;
  text-align: center;
  font-size: 1.3rem;
  font-weight: 300; }

.bigger-image {
  min-width: 130%;
  margin: 5rem 0 5rem -15%; }
  @media only screen and (max-width: 400px) {
    .bigger-image {
      min-width: 114%;
      margin: 2rem 0 2rem -7%; } }
  @media only screen and (min-width: 400px) and (max-width: 1050px) {
    .bigger-image {
      min-width: 114%;
      margin: 2rem 0 2rem -7%; } }

.breaker {
  height: 1px;
  margin: 6rem auto;
  width: 100%; }
  .breaker:before {
    content: "• • •";
    width: 100%;
    text-align: center;
    display: block;
    color: #aaa;
    letter-spacing: 4px;
    position: relative;
    top: -8px; }

.lost-container {
  text-align: center; }

.pagination {
  width: 95%;
  margin: 3rem auto 0;
  text-align: center; }
  .pagination > .page_number {
    display: inline-block;
    font-size: 1.3rem; }
  .pagination > .previous,
  .pagination > .next {
    display: inline-block;
    font-size: 1.8rem;
    position: relative;
    top: 1px;
    padding: 1px 9px; }
  .pagination > .hidden {
    visibility: hidden; }

.related {
  margin: 10rem 0 0rem; }
  .related a {
    font-weight: 300; }

.share {
  float: right;
  width: 40%;
  display: inline;
  text-align: right;
  position: relative;
  top: -10px; }
  @media only screen and (max-width: 400px) {
    .share {
      width: 100%;
      display: block;
      top: 0;
      text-align: left;
      float: none;
      margin-top: 5px; } }
  @media only screen and (min-width: 400px) and (max-width: 1050px) {
    .share {
      width: 100%;
      display: block;
      top: 0;
      text-align: left;
      float: none;
      margin-top: 5px; } }
  .share > .twitter,
  .share > .facebook,
  .share > .linkedin,
  .share > .reddit {
    display: inline;
    vertical-align: middle;
    font-size: 13px;
    font-weight: 700;
    color: #fff;
    padding: 6px 10px;
    border-radius: 3px;
    margin-left: 5px;
    text-decoration: none; }
    @media only screen and (max-width: 400px) {
      .share > .twitter,
      .share > .facebook,
      .share > .linkedin,
      .share > .reddit {
        margin: 0 5px 10px 0; } }
    @media only screen and (min-width: 400px) and (max-width: 1050px) {
      .share > .twitter,
      .share > .facebook,
      .share > .linkedin,
      .share > .reddit {
        margin: 0 5px 10px 0; } }
  .share > .twitter {
    background: #4fafed; }
  .share > .facebook {
    background: #4361b3; }
  .share > .linkedin {
    background: #0077b5; }
  .share > .reddit {
    background: #ff4500; }
  .share svg {
    fill: #fff;
    position: relative;
    top: 3px;
    margin: 0;
    margin-right: 4px;
    display: inherit; }

@media only screen and (min-width: 780px) {
  .side-by-side {
    width: 130%;
    margin: 6rem 0 6rem -15%; } }
@media only screen and (max-width: 780px) {
  .side-by-side {
    width: 100%;
    margin: 4rem 0; } }
.side-by-side > .toleft,
.side-by-side > .toright {
  display: inline-block;
  width: 47.5%; }
  @media only screen and (max-width: 780px) {
    .side-by-side > .toleft img,
    .side-by-side > .toright img {
      text-align: center;
      display: block;
      margin: 0 auto; } }
@media only screen and (min-width: 780px) {
  .side-by-side > .toleft {
    margin-right: 2%; } }
@media only screen and (max-width: 780px) {
  .side-by-side > .toleft {
    width: 100%;
    margin: 0 0 4rem 0; } }
@media only screen and (min-width: 780px) {
  .side-by-side > .toright {
    margin-left: 2%;
    vertical-align: top; } }
@media only screen and (max-width: 780px) {
  .side-by-side > .toright {
    width: 100%;
    margin: 0 0 4rem 0; } }
.side-by-side > .toleft > p,
.side-by-side > .toright > p {
  margin: 0 0 4rem 0; }
  @media only screen and (max-width: 780px) {
    .side-by-side > .toleft > p,
    .side-by-side > .toright > p {
      margin: 0; } }

.social-links {
  margin-top: 20px; }
  .social-links > .link {
    margin: 0;
    text-decoration: none;
    position: relative;
    display: inline-block;
    height: 35px;
    width: 35px; }
    .social-links > .link:hover > .icon {
      fill: #4b0082; }
  .social-links > .icon {
    transition: all ease-in-out 0.2s; }

.spoiler {
  position: relative; }
  .spoiler:before {
    content: "";
    background-color: #fafae0;
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 50; }
  .spoiler:hover:before {
    display: none; }

    </style>

    <!-- for mathjax support -->
    
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    TeX: { equationNumbers: { autoNumber: "AMS" } }
    });
    </script>
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
</head>
<body>

    <div class="wrapper-normal">
        
            <div class="post">
        

            



<nav class="nav">
    <ul class="list">
        
            <li class="item">
                <a class="link" href="https://nicods96.github.io/hi/">Home</a>
            </li>
        

        
            
                <li class="item">
                    <a class="link" href="https://nicods96.github.io/hi/blog">Blog</a>
                </li>
            
        

        
            
                <li class="item">
                    <a class="link" href="https://nicods96.github.io/hi/projects">Projects</a>
                </li>
            
        

        
            
                <li class="item">
                    <a class="link" href="https://nicods96.github.io/hi/about">About</a>
                </li>
            
        

        
    </ul>
</nav>





<h1 class="title">Fast Document Similarity In Python with Minhash Locality Sensitive Hashing (MinHashLSH)</h1>

<span class="date">
    <time datetime="08-09-2022">Thursday. September 08, 2022</time>
     - <span class="reading-time" title="Estimated read time">
    

    
        25 mins
    
</span>

</span>


    <div class="post-tags">
        
            <a class="item" href="https://nicods96.github.io/hi/tags/#python">python</a>
        
            <a class="item" href="https://nicods96.github.io/hi/tags/#lsh">lsh</a>
        
            <a class="item" href="https://nicods96.github.io/hi/tags/#minhash">minhash</a>
        
            <a class="item" href="https://nicods96.github.io/hi/tags/#similarity">similarity</a>
        
            <a class="item" href="https://nicods96.github.io/hi/tags/#forecasting">forecasting</a>
        
    </div>


<!-- USED TO EXPORT MATH FORMULAS IN PDF FROM MARKDOWN

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({ tex2jax: {inlineMath: [['$', '$']]}, messageStyle: "none" });
</script> -->

<!--<img class="image" src="https://nicods96.github.io/hi/assets/images/keep-training/cover.png" alt="Cover Image"/>-->
<p>In the big data era, it is always more frequent that companies need to detect similar items in their database. Imagine platforms like <a href="https://www.kijiji.it/">Kijiji</a> or <a href="https://www.subito.it/">Subito</a>, trying to detect people that constantly duplicate announcements on the platform to boost their visibility without paying for sponsorship offered by the platform.
Assume for example the platform has 1000000 announcements and it wants to detect duplicates. If we try to check one by one all the pairs we need to check 499999500000 (half a trillion) pairs. If it takes a microsecond (0.000001 s) to check a pair, it would take 499999 seconds, that are approximately six days of computation. 
In this article, we are going to explore data mining techniques to speed up the whole process. The whole algorithm is inspired by <a href="http://www.mmds.org/#ver21">chapter 3 of the book “Mining of Massive Datasets”</a>.</p>

<h1 id="dataset">Dataset</h1>
<p>In this guide we will use some announcements of the house for rent in Rome scraped from <a href="https://www.kijiji.it/">Kijiji</a> a few years ago. You can download it from <a href="https://github.com/nicoDs96/Document-Similarity-using-Python-and-PySpark/blob/master/LSH/dataset_rent_rome_kijiji.tsv">here</a>.
The file is a tsv file with header:</p>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>Short Description</th>
      <th>Location</th>
      <th>Price (Euro)</th>
      <th>Timestamp</th>
      <th>Url Adv</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Studio accessoria…</td>
      <td>Affitto studio a …</td>
      <td>Roma</td>
      <td>450</td>
      <td>12 ottobre, 11:32</td>
      <td>https://www.kijij…</td>
    </tr>
    <tr>
      <td>Negozio 169Mq per…</td>
      <td>Privato affitta n…</td>
      <td>Prenestino / Casi…</td>
      <td>1.700</td>
      <td>12 ottobre, 08:45</td>
      <td>https://www.kijij…</td>
    </tr>
    <tr>
      <td>Negozio in tiburt…</td>
      <td>Negozio c/1 roma …</td>
      <td>Tiburtino / Colla…</td>
      <td>6.000</td>
      <td>17 October, 21:20</td>
      <td>https://www.kijij…</td>
    </tr>
    <tr>
      <td>Studio medico via…</td>
      <td>Studio medico avv…</td>
      <td>Trieste / Somalia…</td>
      <td>200</td>
      <td>17 October, 20:22</td>
      <td>https://www.kijij…</td>
    </tr>
  </tbody>
</table>

<p>To read the <a href="https://github.com/nicoDs96/Document-Similarity-using-Python-and-PySpark/blob/master/LSH/dataset_rent_rome_kijiji.tsv">dataset</a> we use the <a href="https://pandas.pydata.org/">pandas</a> library:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="n">dataset</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"dataset_rent_rome_kijiji.tsv"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>
<h1 id="in-brief">In brief</h1>
<p>In the following section we are going to see:</p>
<ol>
  <li>how to transform a document into a set using k-shingling</li>
  <li>how to represent a set in a compressed way computing its signature in such a way that set similarity is preserved, using MinHashing.</li>
  <li>how to implement a hashing function that hashes similar items in the same bucket, using LSH (locality-sensitive hashing).</li>
</ol>

<h1 id="shingling-of-document">Shingling of Document</h1>
<p>In literature, representing documents as sets is considered an effective way to identify lexically similar documents. The <a href="https://en.wikipedia.org/wiki/W-shingling">k-shingles</a> method represents a document as a set of the substrings of length k. 
For example, if your document is ‘I love pizza Margherita, a 6-shingle representation of the document based on characters, including spaces, can be <code class="language-plaintext highlighter-rouge">{'I love', ' love ', 'love p', 'ove pi', ...}</code>. According to the use case, you can compose shingles of words instead of characters or eliminate whitespaces and others.
In Python, we can implement a class that, given the parameter k and a document read into a string, returns the k-shingle set of a document:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">shingler</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">k</span> <span class="o">=</span> <span class="mi">10</span>   
    <span class="c1">#inner class utility
</span>    <span class="k">def</span> <span class="nf">process_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="s">"( )+|(</span><span class="se">\n</span><span class="s">)+"</span><span class="p">,</span><span class="s">" "</span><span class="p">,</span><span class="n">document</span><span class="p">).</span><span class="n">lower</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">get_shingles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">):</span>
        <span class="n">shingles</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">document</span><span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">process_doc</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span> <span class="p">):</span>
            <span class="n">shingles</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">document</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">shingles</span>
</code></pre></div></div>
<p>And use it as follows:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">doc</span> <span class="o">=</span> <span class="s">"I love pizza Margherita!                     xd 1111@</span><span class="se">\n\n\n\n\n\n\n\n\n\n\n\n\n\n</span><span class="s">"</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">shingler_instance</span> <span class="o">=</span> <span class="n">shingler</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">shingles_set</span> <span class="o">=</span> <span class="n">shingler_instance</span><span class="p">.</span><span class="n">get_shingles</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">shingles_set</span>
<span class="p">{</span><span class="s">' xd 1111@ '</span><span class="p">,</span> <span class="s">'herita! xd'</span><span class="p">,</span> <span class="s">'izza margh'</span><span class="p">,</span> <span class="s">'e pizza ma'</span><span class="p">,</span> <span class="s">'rgherita! '</span><span class="p">,</span> <span class="s">'ta! xd 111'</span><span class="p">,</span> <span class="s">'ita! xd 11'</span><span class="p">,</span> <span class="s">' pizza mar'</span><span class="p">,</span> <span class="s">'argherita!'</span><span class="p">,</span> <span class="s">'rita! xd 1'</span><span class="p">,</span> <span class="s">'zza marghe'</span><span class="p">,</span> <span class="s">'a! xd 1111'</span><span class="p">,</span> <span class="s">'a margheri'</span><span class="p">,</span> <span class="s">' love pizz'</span><span class="p">,</span> <span class="s">'erita! xd '</span><span class="p">,</span> <span class="s">'love pizza'</span><span class="p">,</span> <span class="s">'za margher'</span><span class="p">,</span> <span class="s">'margherita'</span><span class="p">,</span> <span class="s">'gherita! x'</span><span class="p">,</span> <span class="s">' margherit'</span><span class="p">,</span> <span class="s">'i love piz'</span><span class="p">,</span> <span class="s">'pizza marg'</span><span class="p">,</span> <span class="s">'ve pizza m'</span><span class="p">,</span> <span class="s">'ove pizza '</span><span class="p">,</span> <span class="s">'! xd 1111@'</span><span class="p">}</span>
</code></pre></div></div>
<p>Now we can check if two documents are similar using the Jaccard Similarity, a popular set similarity indicator:
\(J(s1, s2) = \frac{|s1 \cap s2|}{|s1 \cup s2|}\)</p>

<p>In general, we might want to hash shingles to reduce their size, but even by hashing, they can take in a mean 4 times the size of the original document. So “what’s the point?” you might think. Let me introduce you to MinHashing.</p>

<h1 id="minhash---the-signature-of-a-set">Minhash - The signature of a set</h1>
<p>The minash of a set can be seen as its signature, which is a unique and short representation of the set with a fixed length. The magic of MinHashing for a set is that it preserves Jaccard similarity (more or less).</p>

<p>We can represent a set with its characteristic matrix: a matrix whose columns are sets and rows are elements. The matrix contains a 1 in all the cells that correspond to an element contained in a set.
For example:<br />
S1 = {a, b}, S2 = {a, c} S3 = {a,b,c,d}</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>S1</th>
      <th>S2</th>
      <th>S3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>b</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>c</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>d</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>

<p>Ideally, the minhash function takes a random permutation of the rows and for each set return the first element with a 1 in the characteristic matrix with permuted rows:
if the permutation is <code class="language-plaintext highlighter-rouge">badc</code>, the characteristic matrix is</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>S1</th>
      <th>S2</th>
      <th>S3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>b</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>a</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>d</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>c</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>

<p>and the minhash values are<br />
Minhash(S1) = b<br />
Minhash(S2) = a<br />
Minhash(S3) = b</p>

<p>We obtain a signature of size n for the set if we compute minhash for n random permutations of the rows of the characteristic matrix.</p>

<h3 id="minhash-in-practice">Minhash in practice</h3>
<p>The permutation approach is not feasible in practice, hence once again we use hash functions to approximate. We define a family of hash functions as</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="c1"># the family of hash functions, in this case, is the same function (sha1) applied with a different salt.
</span><span class="k">class</span> <span class="nc">hashFamily</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">resultSize</span> <span class="o">=</span> <span class="mi">8</span> <span class="c1"># how many bytes we want back
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">maxLen</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># how long can our salt be (in decimal)
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">salt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">zfill</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">maxLen</span><span class="p">)[</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">maxLen</span><span class="p">:]</span>
        
    <span class="k">def</span> <span class="nf">get_hash_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">el_to_hash</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">hashlib</span><span class="p">.</span><span class="n">sha1</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">el_to_hash</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">salt</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)).</span><span class="n">hexdigest</span><span class="p">()[</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">resultSize</span><span class="p">:],</span> <span class="mi">16</span><span class="p">)</span>
    
<span class="c1"># NOTE: we use sha1 to avoid installing and importing an external library, sacrificing performances. No crypto-hash is required for this use case.
</span></code></pre></div></div>
<p>Then we compute a minhash signature for a set with the following algorithm:</p>
<ol>
  <li>Take the first hash function, and apply it to all of the shingle values in a document. Find the minimum hash value produced and use it as the first component of the MinHash signature.</li>
  <li>Now take the second hash function, and again find the minimum resulting hash value, and use this as the second component.</li>
  <li>And so on…</li>
</ol>

<p>So if we have 10 random hash functions, we’ll get a MinHash signature with 10 values for each set. We’ll use the same 10 hash functions for every document in the dataset and generate their signatures as well.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span><span class="p">,</span> <span class="n">seed</span>
<span class="k">class</span> <span class="nc">minhashSigner</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig_size</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sig_size</span><span class="o">=</span><span class="n">sig_size</span>
        <span class="c1"># Init the hash family of functions using a random salt
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">hash_functions</span> <span class="o">=</span> <span class="p">[</span><span class="n">hashFamily</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000000000</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sig_size</span><span class="p">)]</span>
    
    <span class="k">def</span> <span class="nf">compute_set_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_</span><span class="p">):</span>
        <span class="n">set_sig</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">h_funct</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">hash_functions</span><span class="p">:</span>
            <span class="n">min_hash</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">inf</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">set_</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">h_funct</span><span class="p">.</span><span class="n">get_hash_value</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">min_hash</span><span class="p">:</span>
                    <span class="n">min_hash</span> <span class="o">=</span> <span class="n">h</span>
                
            <span class="n">set_sig</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">min_hash</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">set_sig</span>
    <span class="c1">#return a list of lists that can be seen as the signature matrix
</span>    <span class="k">def</span> <span class="nf">compute_signature_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_list</span><span class="p">):</span>
        <span class="n">signatures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">set_list</span><span class="p">:</span>
            <span class="n">signatures</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="p">.</span><span class="n">compute_set_signature</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">signatures</span>
</code></pre></div></div>
<p>Example usage:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">doc</span> <span class="o">=</span> <span class="s">"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">doc2</span> <span class="o">=</span> <span class="s">"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident bla bla bla."</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">shingler_inst</span> <span class="o">=</span> <span class="n">shingler</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">shinglings</span> <span class="o">=</span> <span class="n">shingler_inst</span><span class="p">.</span><span class="n">get_shingles</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">shinglings2</span> <span class="o">=</span> <span class="n">shingler_inst</span><span class="p">.</span><span class="n">get_shingles</span><span class="p">(</span><span class="n">doc2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">minhash_sig</span> <span class="o">=</span> <span class="n">minhashSigner</span><span class="p">(</span><span class="mi">20</span><span class="p">).</span><span class="n">compute_signature_matrix</span><span class="p">([</span><span class="n">shinglings</span><span class="p">,</span><span class="n">shinglings2</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">minhash_sig</span>
<span class="p">[[</span><span class="mi">1783860</span><span class="p">,</span> <span class="mi">5303198</span><span class="p">,</span> <span class="mi">4845898</span><span class="p">,</span> <span class="mi">3935831</span><span class="p">,</span> <span class="mi">198103</span><span class="p">,</span> <span class="mi">5887007</span><span class="p">,</span> <span class="mi">8061377</span><span class="p">,</span> <span class="mi">4526224</span><span class="p">,</span> <span class="mi">8467452</span><span class="p">,</span> <span class="mi">7766250</span><span class="p">,</span> <span class="mi">15505788</span><span class="p">,</span> <span class="mi">825368</span><span class="p">,</span> <span class="mi">12316643</span><span class="p">,</span> <span class="mi">4502308</span><span class="p">,</span> <span class="mi">6403903</span><span class="p">,</span> <span class="mi">9259449</span><span class="p">,</span> <span class="mi">8533874</span><span class="p">,</span> <span class="mi">31889076</span><span class="p">,</span> <span class="mi">940623</span><span class="p">,</span> <span class="mi">278359</span><span class="p">],</span> <span class="p">[</span><span class="mi">1783860</span><span class="p">,</span> <span class="mi">20203690</span><span class="p">,</span> <span class="mi">4845898</span><span class="p">,</span> <span class="mi">3935831</span><span class="p">,</span> <span class="mi">198103</span><span class="p">,</span> <span class="mi">12350289</span><span class="p">,</span> <span class="mi">8061377</span><span class="p">,</span> <span class="mi">4526224</span><span class="p">,</span> <span class="mi">8467452</span><span class="p">,</span> <span class="mi">7766250</span><span class="p">,</span> <span class="mi">15505788</span><span class="p">,</span> <span class="mi">825368</span><span class="p">,</span> <span class="mi">12316643</span><span class="p">,</span> <span class="mi">6122847</span><span class="p">,</span> <span class="mi">6403903</span><span class="p">,</span> <span class="mi">9259449</span><span class="p">,</span> <span class="mi">8533874</span><span class="p">,</span> <span class="mi">31889076</span><span class="p">,</span> <span class="mi">940623</span><span class="p">,</span> <span class="mi">278359</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">set_sig_1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">minhash_sig</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">set_sig_2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">minhash_sig</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">jaccard_similarity_sig</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">set_sig_1</span><span class="p">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">set_sig_2</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">set_sig_1</span><span class="p">.</span><span class="n">union</span><span class="p">(</span><span class="n">set_sig_2</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">jaccard_similarity_sig</span>
<span class="mf">0.7391304347826086</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">jaccard_similarity_shingle_set</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">shinglings</span><span class="p">).</span><span class="n">intersection</span><span class="p">(</span><span class="n">shinglings2</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">shinglings</span><span class="p">).</span><span class="n">union</span><span class="p">(</span><span class="n">shinglings2</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">jaccard_similarity_shingle_set</span>
<span class="mf">0.8285077951002228</span>
</code></pre></div></div>
<p>From the example, we can see that the Jaccard similarity between set signatures is near to the similarity between shingle sets. Of course, we can achieve a lower approximation error by tuning the shingle size and signature size.</p>

<h1 id="locality-sensitive-hashing">Locality Sensitive Hashing</h1>
<p>Quoting <a href="http://www.mmds.org/#ver21">“Mining of Massive Datasets”</a></p>
<blockquote>
  <p>Locality-sensitive hashing (also known as near-neighbor search) is a general theory focused on how to approximatively find similar pairs without investigating all of them. The principle is that we are going to hash items several times in such a way that similar items are more likely to be hashed to the same bucket than dissimilar items are.
When you have a minhashed set a popular choice for LSH is the “banding technique”, that is:</p>
  <ol>
    <li>get the signature matrix and divide it into bands</li>
    <li>hash each column of the band. The elements that hash to the same bucket are likely to be similar.</li>
    <li>repeat for all the bands. You can use the same hash function of the previous band but you must use different buckets.</li>
  </ol>
</blockquote>

<!--image here -->
<p>In python:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">lsh</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>
    <span class="k">def</span> <span class="nf">get_signature_matrix_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig_matrix</span><span class="p">,</span> <span class="n">bands_nr</span><span class="p">,</span> <span class="n">sign_len</span><span class="p">):</span> 
        <span class="c1">#bands_nr = b
</span>        <span class="c1">#sign_len = n
</span>        <span class="n">r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sign_len</span><span class="o">/</span><span class="n">bands_nr</span><span class="p">)</span> <span class="c1">#number of rows in each band
</span>        <span class="n">bands</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># {band_nr: [col_1,col_2,...]} where col_1 is all the values of Sig(S_i) for band b.
</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">bands_nr</span><span class="p">):</span>
            <span class="n">bands</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># put Subsets of the columns of signature matrix into the appropriate bucket and cosider a column 
</span>        <span class="c1"># as a unique block so that we can hash the entire column.
</span>        <span class="c1"># Basically a band is a list of element, where each element is a subset of a signature of a given set.
</span>        <span class="k">for</span> <span class="n">signature</span> <span class="ow">in</span> <span class="n">sig_matrix</span><span class="p">:</span> 
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bands_nr</span><span class="p">):</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">r</span>    
                <span class="n">bands</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="s">' '</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">signature</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="n">r</span><span class="p">])</span> <span class="p">)</span>          
        <span class="k">return</span> <span class="n">bands</span>
    <span class="c1">#band is a list 
</span>    <span class="c1"># construct a dictionary {hash(band_column): doc_id that produced this hash}
</span>    <span class="k">def</span> <span class="nf">get_band_buckets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">hash_funct</span><span class="p">):</span>
        <span class="n">buckets</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">doc_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">band</span><span class="p">)):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">hash_funct</span><span class="p">.</span><span class="n">get_hash_value</span><span class="p">(</span> <span class="n">band</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">buckets</span><span class="p">:</span>
                <span class="n">buckets</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc_id</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">buckets</span><span class="p">[</span><span class="n">value</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">doc_id</span><span class="p">)</span>      
        <span class="k">return</span> <span class="n">buckets</span>
    <span class="k">def</span> <span class="nf">get_candidates_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buckets</span><span class="p">):</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c1"># buckets is a dictionary containing key=bucket, value= list of doc_ids that hashed to bucket
</span>        <span class="k">for</span> <span class="n">bucket</span><span class="p">,</span><span class="n">candidate_list</span> <span class="ow">in</span> <span class="n">buckets</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidate_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">candidate_list</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">candidate_list</span><span class="p">)):</span>  
                        <span class="n">pair</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span> <span class="p">(</span><span class="n">candidate_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">candidate_list</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="p">))</span>
                        <span class="n">candidates</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">candidates</span> <span class="c1">#ie a set of couples, each couple is a candidate pair
</span>    <span class="k">def</span> <span class="nf">check_candidates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">candidates_list</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">sigs</span><span class="p">):</span>
        <span class="n">similar_docs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="c1">#set of tuples
</span>        <span class="c1"># similar_pair is a couple containing doc_ids of documents that hashed to same bucket
</span>        <span class="k">for</span>  <span class="n">similar_pair</span> <span class="ow">in</span> <span class="n">candidates_list</span><span class="p">:</span>
            <span class="c1">#for all the pairs of document in the list check similarity of their signatures
</span>            <span class="n">doc_id_1</span> <span class="o">=</span> <span class="n">similar_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">doc_id_2</span> <span class="o">=</span> <span class="n">similar_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">signature_1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">sigs</span><span class="p">[</span><span class="n">doc_id_1</span><span class="p">])</span> <span class="c1">#get the i-th column from signature matrix where i is doc_id in the collision list
</span>            <span class="n">signature_2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">sigs</span><span class="p">[</span><span class="n">doc_id_2</span><span class="p">])</span>
            <span class="n">js</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">signature_1</span><span class="p">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">signature_2</span><span class="p">))</span> <span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">signature_1</span><span class="p">.</span><span class="n">union</span><span class="p">(</span><span class="n">signature_2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">js</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">similar_docs</span><span class="p">.</span><span class="n">add</span><span class="p">(</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">((</span><span class="n">doc_id_1</span><span class="p">,</span><span class="n">doc_id_2</span><span class="p">)</span> <span class="p">))</span> <span class="p">)</span>          
        <span class="k">return</span> <span class="n">similar_docs</span>
    <span class="k">def</span> <span class="nf">get_similar_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig_matrix</span><span class="p">,</span> <span class="n">bands_nr</span><span class="p">,</span> <span class="n">sign_len</span><span class="p">):</span>
        <span class="n">similar_docs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c1">#divide signature matrix into bands
</span>        <span class="n">bands</span> <span class="o">=</span> <span class="n">lsh_instance</span><span class="p">.</span><span class="n">get_signature_matrix_bands</span><span class="p">(</span><span class="n">sig_matrix</span><span class="p">,</span><span class="n">bands_nr</span><span class="p">,</span><span class="n">sign_len</span><span class="p">)</span>
        <span class="c1">#for all the bands
</span>        <span class="k">for</span> <span class="n">band_id</span><span class="p">,</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1">#produce the buckets for the given band (band_id) with a random hash function
</span>            <span class="n">buckets</span> <span class="o">=</span> <span class="n">lsh_instance</span><span class="p">.</span><span class="n">get_band_buckets</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">hash_funct</span><span class="o">=</span><span class="n">hashFamily</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000000000</span><span class="p">)))</span>
            <span class="c1">#Get all the candidate pairs
</span>            <span class="n">candidates</span> <span class="o">=</span> <span class="n">lsh_instance</span><span class="p">.</span><span class="n">get_candidates_list</span><span class="p">(</span><span class="n">buckets</span><span class="p">)</span>
            <span class="c1">#Check all candidate pairs' signatures
</span>            <span class="k">for</span> <span class="n">sim_tuple</span> <span class="ow">in</span> <span class="n">lsh_instance</span><span class="p">.</span><span class="n">check_candidates</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">threshold</span><span class="p">,</span> <span class="n">sig_matrix</span><span class="p">):</span>
                <span class="n">similar_docs</span><span class="p">.</span><span class="n">add</span><span class="p">(</span> <span class="n">sim_tuple</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">similar_docs</span> <span class="c1">#return all the similar signatures that respect the threshold
</span></code></pre></div></div>
<p>The class performs the following tasks:</p>

<ol>
  <li>Divide signature matrix into bands with <code class="language-plaintext highlighter-rouge">get_signature_matrix_bands(sig_matrix, bands_nr, sign_len)</code>. The method will return a list of strings where each string represents a column of the signature matrix for the given band. It is done to hash the entire column next when producing buckets.</li>
  <li>Compute buckets for each band with <code class="language-plaintext highlighter-rouge">get_band_buckets(band, hash_funct)</code>, which will take as input a band <code class="language-plaintext highlighter-rouge">b</code> and a hash function <code class="language-plaintext highlighter-rouge">h</code> and will return a dict containing as key the bucket ids and as value a list of document ids that hashed to that bucket for the given band <code class="language-plaintext highlighter-rouge">b</code>: ${bucket_{id}:[doc_i, doc_k, …] } $.</li>
  <li>With <code class="language-plaintext highlighter-rouge">get_candidates_list(buckets)</code> we are going to take as input a list of buckets (whose union is the signature matrix) and will produce as output a set of tuples: those tuples represent documents that are hashed in the same bucket.</li>
  <li>With <code class="language-plaintext highlighter-rouge">check_candidates(candidates_list, threshold, sigs)</code> we take all the candidates from all the bands and check if effectively their signatures produce a match with approximate Jaccard similarity greater than the threshold we give as a parameter.</li>
  <li>With <code class="language-plaintext highlighter-rouge">get_similar_items(sig_matrix, bands_nr, sign_len)</code> we put together all the methods listed above and return the ids of similar documents that respect the threshold value.</li>
</ol>

<p>The similarity threshold is passed as a value to the constructor of the class, default is 0.8.</p>

<p>Example usage:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">shingler_inst</span> <span class="o">=</span> <span class="n">shingler</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">doc</span> <span class="o">=</span> <span class="s">"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">doc2</span> <span class="o">=</span> <span class="s">"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident bla bla bla."</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">shinglings</span> <span class="o">=</span> <span class="n">shingler_inst</span><span class="p">.</span><span class="n">get_shingles</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">shinglings</span> <span class="o">=</span> <span class="n">shingler_inst</span><span class="p">.</span><span class="n">get_hashed_shingles</span><span class="p">(</span><span class="n">shinglings</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">shingle2</span> <span class="o">=</span> <span class="n">shingler_inst</span><span class="p">.</span><span class="n">get_shingles</span><span class="p">(</span><span class="n">doc2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">shingle2</span> <span class="o">=</span> <span class="n">shingler_inst</span><span class="p">.</span><span class="n">get_hashed_shingles</span><span class="p">(</span><span class="n">shingle2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">signer</span> <span class="o">=</span> <span class="n">minhashSigner</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">signature_matrix</span> <span class="o">=</span> <span class="n">signer</span><span class="p">.</span><span class="n">compute_signature_matrix</span><span class="p">([</span><span class="n">shinglings</span><span class="p">,</span><span class="n">shingle2</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">lsh_instance</span> <span class="o">=</span> <span class="n">lsh</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">lsh_instance</span><span class="p">.</span><span class="n">get_similar_items</span><span class="p">(</span><span class="n">signature_matrix</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)}</span>
</code></pre></div></div>

<h1 id="benchmark-time">Benchmark Time</h1>
<p>Now that we have implemented the whole code for fast approximate duplicate document detection, let’s test it out against brute force detection and see what happens.
As the first step, we load the <a href="https://github.com/nicoDs96/Document-Similarity-using-Python-and-PySpark/blob/master/LSH/dataset_rent_rome_kijiji.tsv">dataset</a> as a pandas data frame.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">"Loading dataset..."</span><span class="p">)</span>
<span class="n">dataset</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"dataset_rent_rome_kijiji.tsv"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">)</span>
<span class="n">dataset</span><span class="p">[</span><span class="s">'doc_id'</span><span class="p">]</span><span class="o">=</span><span class="n">dataset</span><span class="p">.</span><span class="n">index</span>
<span class="n">doc_nr</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s">'doc_id'</span><span class="p">].</span><span class="nb">max</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Dataset loaded correctly."</span><span class="p">)</span>
</code></pre></div></div>
<p>Then transform documents into k-shingles.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">"Producing Shingles..."</span><span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="c1">#an array where the index i represent the document_id and the element shingling_list[i] the hashed shingles for document document_id
</span><span class="n">shingling_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">doc_nr</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span> 
<span class="n">shingling_size</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">signature_size</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">bands_nr</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">shingler_inst</span> <span class="o">=</span> <span class="n">shingler</span><span class="p">(</span><span class="n">shingling_size</span><span class="p">)</span>

<span class="c1">#produce hashed shinglings for all documents
</span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">'Title'</span><span class="p">]</span><span class="o">+</span><span class="s">" "</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s">'Short Description'</span><span class="p">]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">'doc_id'</span><span class="p">]</span>
    
    <span class="n">shinglings</span> <span class="o">=</span> <span class="n">shingler_inst</span><span class="p">.</span><span class="n">get_hashed_shingles</span><span class="p">(</span> <span class="n">shingler_inst</span><span class="p">.</span><span class="n">get_shingles</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">shingling_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">shinglings</span>

<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Shingles produced in:</span><span class="se">\t</span><span class="s"> %.2f seconds."</span><span class="o">%</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span>
</code></pre></div></div>
<p>And we sign all the shingles and get the signature matrix.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">signer</span> <span class="o">=</span> <span class="n">minhashSigner</span><span class="p">(</span><span class="n">signature_size</span><span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Computing signature matrix..."</span><span class="p">)</span>
<span class="c1">#produce a signature for each shingle set
</span><span class="n">signature_matrix</span> <span class="o">=</span> <span class="n">signer</span><span class="p">.</span><span class="n">compute_signature_matrix</span><span class="p">(</span> <span class="n">shingling_list</span> <span class="p">)</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Signature Matrix computed in:</span><span class="se">\t</span><span class="s"> %.2f seconds."</span> <span class="o">%</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span>
</code></pre></div></div>
<p>In the end, we compute similar pairs with LSH.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lsh_instance</span> <span class="o">=</span> <span class="n">lsh</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Computing LSH similarity..."</span><span class="p">)</span>
<span class="n">lsh_similar_itemset</span> <span class="o">=</span> <span class="n">lsh_instance</span><span class="p">.</span><span class="n">get_similar_items</span><span class="p">(</span><span class="n">signature_matrix</span><span class="p">,</span> <span class="n">bands_nr</span><span class="p">,</span> <span class="n">signature_size</span><span class="p">)</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">lsh_computation_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
<span class="k">print</span><span class="p">(</span><span class="s">"LSH Similarity computed in:</span><span class="se">\t</span><span class="s"> %.2f seconds.</span><span class="se">\n</span><span class="s">Similar Elements Found: %d"</span> <span class="o">%</span><span class="p">(</span><span class="n">lsh_computation_time</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lsh_similar_itemset</span><span class="p">)))</span>
</code></pre></div></div>

<p>We compute the similar pairs using brute force</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">bfsc</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">compare_shingles_set_js</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set1</span><span class="p">,</span> <span class="n">set2</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">set1</span><span class="p">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">set2</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">set1</span><span class="p">.</span><span class="n">union</span><span class="p">(</span><span class="n">set2</span><span class="p">))</span>

<span class="n">brute_force_comparer</span> <span class="o">=</span> <span class="n">bfsc</span><span class="p">()</span>
<span class="n">brute_force_similar_items</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">doc_nr</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">doc_nr</span><span class="p">):</span>
        <span class="n">similarity</span> <span class="o">=</span> <span class="n">brute_force_comparer</span><span class="p">.</span><span class="n">compare_shingles_set_js</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">shingling_list</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="nb">set</span><span class="p">(</span><span class="n">shingling_list</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">similarity</span> <span class="o">&gt;=</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="n">brute_force_similar_items</span><span class="p">.</span><span class="n">add</span><span class="p">(</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="p">)</span> 
            
<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">bf_computation_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>      
</code></pre></div></div>

<p>Check for similar pairs</p>
<ol>
  <li>LSH
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docs</span> <span class="o">=</span> <span class="n">lsh_similar_itemset</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Doc 1:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Is similar to</span><span class="se">\n</span><span class="s">Doc2:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">docs</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>Brute Force
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docs</span> <span class="o">=</span> <span class="n">brute_force_similar_items</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Doc 1:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Is similar to</span><span class="se">\n</span><span class="s">Doc2:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">docs</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="p">)</span>
</code></pre></div>    </div>
    <p>Print stats<br />
```python
report = (‘LSH\n%.2f seconds to execute\n’
 ‘%d similar documents found\n\n’
 ‘Bruteforce search\n%.2f seconds to execute\n’
 ‘%d similar documents found.\n\n’
 ‘They find %d common similarities.’)</p>
  </li>
</ol>

<p>print(report %(lsh_computation_time, len(lsh_similar_itemset),bf_computation_time,len(brute_force_similar_items),len(brute_force_similar_items.intersection(lsh_similar_itemset)) ))
```</p>

<h1 id="conclusion">Conclusion</h1>
<p>In this article we have seen:</p>
<ol>
  <li>how to transform a document into a set using k-shingling</li>
  <li>how to represent a set in a compressed way computing its signature in such a way that set similarity is preserved, using MinHashing.</li>
  <li>how to implement a hashing function that hashes similar items in the same bucket, using LSH (locality-sensitive hashing).</li>
  <li>how to compare the approximate method with the brute force method.</li>
</ol>

<p>All the theory behind the code here can be found in <a href="http://www.mmds.org/#ver21">chapter 3 of the book “Mining of Massive Datasets”</a></p>

<p>You can find the full example on <a href="https://github.com/nicoDs96/Document-Similarity-using-Python-and-PySpark/blob/master/LSH/DM_HW2_Ex2.ipynb">GitHub</a>. I wrote also a notebook with an Apache Spark implementation, available <a href="https://github.com/nicoDs96/Document-Similarity-using-Python-and-PySpark/blob/master/LSH/DM_HW2_Ex2.ipynb">on GitHub</a>.</p>

<p>Despite it is interesting to understand how that algorithm works, it is always a good idea to check for robust libraries to put this algorithm in production. A lot how implementations exist depending on the use case, here there are a fews:</p>
<ul>
  <li><a href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.feature.MinHashLSH.html#pyspark.ml.feature.MinHashLSH">Apache Spark Implementation</a></li>
  <li><a href="http://ekzhu.com/datasketch/">datasketch</a></li>
  <li><a href="https://proxy-nyc.hidemyass-freeproxy.com/proxy/it-it/aHR0cHM6Ly93d3cudWJlci5jb20vYmxvZy9sc2gv">LSH usage @ Uber</a></li>
  <li><a href="https://github.com/idealista/tlsh-js">Idealista implementation</a></li>
  <li><a href="https://github.com/spotify/annoy">Spotify implementation</a></li>
  <li><a href="https://engineering.fb.com/2017/03/29/data-infrastructure/faiss-a-library-for-efficient-similarity-search/">Facebook implementation</a></li>
  <li><a href="https://github.com/erikbern/ann-benchmarks">Benchmarks of some implementations</a></li>
</ul>



    <div class="blog-navigation">
        
            <a class="prev" href="https://nicods96.github.io/hi/dates-intersection-conditions-on-SCD-columns-like-a-pro/">&laquo; Dates intersection on SCD columns like a pro</a>
        
        
            <a class="next" href="https://nicods96.github.io/hi/building-a-custom-news-feed/">Building a custom news feed &raquo;</a>
        
    </div>



    <div class="related">
    
    
        
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
                    
                    <h4>Related Posts</h4>
                    <ul>
                    
                    <li class="relatedPost">
                        <a href="https://nicods96.github.io/hi/introducing-pyrcodio/">Introducing pyrcodio
                        
                        </a>
                    </li>
                    
                    
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
    
        
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
    
        
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
    
        
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
    
        
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
    
        
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
    
        
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
    
        
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
                    
                    <li class="relatedPost">
                        <a href="https://nicods96.github.io/hi/designing-a-pytorch-deep-reinforcement-learning-trading-bot/">Designing A Deep Reinforcement Learning Trading Bot With PyTorch
                        
                        </a>
                    </li>
                    
                    
                
            
        
    
        
        
            
                
            
                
            
                
            
                
            
                
            
        
    
        
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
    
        
        
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
        
    
    
        </ul>
    
</div>




    <section class="author">
    <div class="toleft">
        <img
            class="selfie"
            src="https://nicods96.github.io/hi/assets/images/profile.jpg"
            alt="Nicola Di Santo"
        />
    </div>

    <div class="toright">
        <h4 class="name">Nicola Di Santo</h4>
        <p class="bio">A Person who loves tech, bikes and fighting sports</p>

        <div class="share">
            <!-- Note: Only use three share links if your site width is set to large -->
            <!-- If site width is set to normal, you may choose any two share links -->
            <a
                class="twitter"
                href="https://twitter.com/intent/tweet?text=https://nicods96.github.io/hi/fast-document-similarity-in-python/ - Fast Document Similarity In Python with Minhash Locality Sensitive Hashing (MinHashLSH) by @johndoe"
            >
                <svg class="icon icon-twitter">
                    <use xlink:href="#icon-twitter"></use></svg
                ><span class="icon-twitter">Tweet</span>
            </a>

            <a
                class="facebook"
                href="javascript:void(0)"
                onclick="window.open('https://facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href), 'facebook-share-dialog', 'width=626,height=436'); return false;"
            >
                <svg class="icon icon-facebook">
                    <use xlink:href="#icon-facebook"></use></svg
                ><span class="icon-facebook-rect">Share</span>
            </a>

            <!-- <a class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://nicods96.github.io/hi/fast-document-similarity-in-python/&amp;title=Fast Document Similarity In Python with Minhash Locality Sensitive Hashing (MinHashLSH)&amp;summary=How to implement fast document duplicate detection in python using locality sensitive hashing.&amp;source=https://nicods96.github.io/hi" target="_blank">
                <svg class="icon icon-linkedin"><use xlink:href="#icon-linkedin"></use></svg><span class="icon-linkedin">Share</span>
            </a> -->

            <!-- <a class="reddit" href="https://reddit.com/submit?url=https://nicods96.github.io/hi/fast-document-similarity-in-python/&amp;title=Fast Document Similarity In Python with Minhash Locality Sensitive Hashing (MinHashLSH)" target="_blank">
                <svg class="icon icon-reddit"><use xlink:href="#icon-reddit"></use></svg><span class="icon-reddit">Share</span>
            </a> -->
        </div>
    </div>
</section>






<footer class="footer-main">
    Nicola Di Santo © 2025

    <a class="link" href="https://nicods96.github.io/hi/feed.xml" target="_blank">
        <svg class="icon icon-rss">
            <use xlink:href="#icon-rss"></use>
        </svg>
    </a>

    <p class="extra">
        <a class="link" href="https://github.com/sergiokopplin/indigo">Indigo theme</a>
        by
        <a class="link" href="https://github.com/sergiokopplin/indigo">Kopplin</a>
    </p>
</footer>


        </div>
    </div>

    <svg
    display="none"
    version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
>
    <defs>
        <symbol id="icon-rss" viewBox="0 0 1024 1024">
            <title>rss</title>
            <path
                class="path1"
                d="M122.88 122.88v121.19c362.803 0 656.896 294.195 656.896 656.998h121.293c0-429.773-348.416-778.189-778.189-778.189zM122.88 365.414v121.293c228.813 0 414.362 185.498 414.362 414.413h121.242c0-295.834-239.821-535.706-535.603-535.706zM239.053 668.621c-64.205 0-116.224 52.122-116.224 116.275s52.019 116.224 116.224 116.224 116.173-52.019 116.173-116.224-51.968-116.275-116.173-116.275z"
            ></path>
        </symbol>

        <symbol id="icon-facebook" viewBox="0 0 1024 1024">
            <title>facebook</title>
            <path
                class="path1"
                d="M870.4 51.2h-716.8c-56.32 0-102.4 46.080-102.4 102.4v716.8c0 56.371 46.080 102.4 102.4 102.4h358.4v-358.4h-102.4v-126.72h102.4v-104.96c0-110.797 62.054-188.621 192.819-188.621l92.314 0.102v133.376h-61.286c-50.893 0-70.246 38.195-70.246 73.626v86.528h131.482l-29.082 126.669h-102.4v358.4h204.8c56.32 0 102.4-46.029 102.4-102.4v-716.8c0-56.32-46.080-102.4-102.4-102.4z"
            ></path>
        </symbol>

        <symbol id="icon-twitter" viewBox="0 0 1024 1024">
            <title>twitter</title>
            <path
                class="path1"
                d="M886.579 319.795c0.41 8.294 0.563 16.691 0.563 24.986 0 255.488-194.406 549.99-549.888 549.99-109.21 0-210.739-32-296.294-86.886 15.155 1.792 30.515 2.714 46.080 2.714 90.624 0 173.926-30.925 240.026-82.688-84.531-1.587-155.955-57.395-180.531-134.195 11.776 2.202 23.91 3.379 36.352 3.379 17.664 0 34.765-2.304 50.944-6.707-88.422-17.818-155.034-95.898-155.034-189.594 0-0.819 0-1.587 0-2.406 26.061 14.49 55.91 23.194 87.552 24.218-51.866-34.714-86.016-93.798-86.016-160.922 0-35.379 9.523-68.608 26.214-97.178 95.283 116.992 237.773 193.894 398.387 201.984-3.277-14.182-4.966-28.877-4.966-44.083 0-106.701 86.477-193.178 193.229-193.178 55.603 0 105.83 23.398 141.107 60.979 43.981-8.704 85.35-24.781 122.726-46.899-14.438 45.107-45.107 82.995-84.992 106.906 39.117-4.71 76.288-15.002 111.002-30.413-25.907 38.81-58.675 72.806-96.461 99.994z"
            ></path>
        </symbol>

        <symbol id="icon-github" viewBox="0 0 1024 1024">
            <title>github</title>
            <path
                class="path1"
                d="M674.816 579.021c-36.762 0-66.56 41.318-66.56 92.109 0 50.893 29.798 92.211 66.56 92.211s66.56-41.318 66.56-92.211c-0.051-50.79-29.798-92.109-66.56-92.109zM906.547 339.251c7.629-18.688 7.936-124.877-32.512-226.611 0 0-92.723 10.189-233.011 106.496-29.44-8.192-79.258-12.186-128.973-12.186-49.818 0-99.584 3.994-129.024 12.186-140.339-96.307-233.062-106.496-233.062-106.496-40.397 101.734-39.987 207.923-32.461 226.611-47.514 51.61-76.544 113.613-76.544 198.195 0 367.923 305.306 373.811 382.31 373.811 17.51 0 52.122 0.102 88.781 0.102 36.608 0 71.27-0.102 88.678-0.102 77.107 0 382.31-5.888 382.31-373.811 0-84.582-28.979-146.586-76.493-198.195zM513.434 866.048h-2.867c-193.075 0-343.501-22.989-343.501-210.688 0-45.005 15.872-86.682 53.606-121.293 62.822-57.702 169.216-27.187 289.894-27.187 0.512 0 1.024 0 1.485 0 0.512 0 0.922 0 1.382 0 120.678 0 227.123-30.515 289.997 27.187 37.632 34.611 53.504 76.288 53.504 121.293 0 187.699-150.374 210.688-343.501 210.688zM349.235 579.021c-36.762 0-66.56 41.318-66.56 92.109 0 50.893 29.798 92.211 66.56 92.211 36.813 0 66.611-41.318 66.611-92.211 0-50.79-29.798-92.109-66.611-92.109z"
            ></path>
        </symbol>

        <symbol id="icon-mail" viewBox="0 0 1024 1024">
            <title>mail</title>
            <path
                class="path1"
                d="M80.589 270.643c24.986 13.414 371.098 199.373 384 206.285s29.594 10.189 46.387 10.189c16.794 0 33.485-3.277 46.387-10.189s359.014-192.87 384-206.285c25.037-13.466 48.691-65.843 2.765-65.843h-866.253c-45.926 0-22.272 52.378 2.714 65.843zM952.986 383.437c-28.416 14.797-378.214 197.069-395.622 206.182s-29.594 10.189-46.387 10.189-28.979-1.075-46.387-10.189-365.21-191.437-393.626-206.234c-19.968-10.445-19.763 1.792-19.763 11.213s0 373.402 0 373.402c0 21.504 28.979 51.2 51.2 51.2h819.2c22.221 0 51.2-29.696 51.2-51.2 0 0 0-363.93 0-373.35s0.205-21.658-19.814-11.213z"
            ></path>
        </symbol>

        <symbol id="icon-instagram" viewBox="0 0 1024 1024">
            <title>instagram</title>
            <path
                class="path1"
                d="M870.4 51.2h-716.8c-56.32 0-102.4 46.080-102.4 102.4v716.8c0 56.371 46.080 102.4 102.4 102.4h716.8c56.32 0 102.4-46.029 102.4-102.4v-716.8c0-56.32-46.080-102.4-102.4-102.4zM511.181 794.778c156.621 0 283.546-127.027 283.546-283.597 0-17.306-2.202-33.997-5.274-50.381h80.947v369.459c0 19.558-15.872 35.328-35.482 35.328h-645.837c-19.61 0-35.482-15.77-35.482-35.328v-369.459h79.309c-3.123 16.384-5.325 33.075-5.325 50.381 0 156.621 127.027 283.597 283.597 283.597zM333.978 511.181c0-97.894 79.36-177.203 177.254-177.203 97.843 0 177.254 79.309 177.254 177.203s-79.411 177.254-177.254 177.254c-97.946 0-177.254-79.36-177.254-177.254zM834.918 307.2h-82.688c-19.558 0-35.43-15.974-35.43-35.43v-82.79c0-19.558 15.872-35.379 35.379-35.379h82.688c19.661 0 35.533 15.821 35.533 35.379v82.739c0 19.507-15.872 35.482-35.482 35.482z"
            ></path>
        </symbol>

        <symbol id="icon-linkedin" viewBox="0 0 1024 1024">
            <title>linkedin</title>
            <path
                class="path1"
                d="M256 153.6c0 54.374-36.352 101.171-102.451 101.171-62.208 0-102.349-44.134-102.349-98.509 0-55.808 38.912-105.062 102.4-105.062s101.171 46.592 102.4 102.4zM51.2 972.8v-665.6h204.8v665.6h-204.8z"
            ></path>
            <path
                class="path2"
                d="M358.4 534.733c0-79.104-2.611-145.203-5.222-202.291h184.013l9.114 88.218h3.891c25.907-41.523 89.395-102.4 195.686-102.4 129.638 0 226.918 86.784 226.918 273.51v381.030h-204.8v-351.283c0-81.613-31.078-143.872-102.4-143.872-54.374 0-81.613 44.032-95.898 80.333-5.222 13.005-6.502 31.13-6.502 49.306v365.517h-204.8v-438.067z"
            ></path>
        </symbol>
    </defs>
</svg>


</body>
</html>

